// ===== СИСТЕМА РЕГИСТРАЦИИ И АВТОРИЗАЦИИ =====
let currentUser = null;
let users = {};

// Загрузка пользователей из localStorage
function loadUsers() {
    try {
        const savedUsers = localStorage.getItem('pirlsUsers');
        if (savedUsers) {
            users = JSON.parse(savedUsers);
        }
    } catch (e) {
        console.error('Ошибка загрузки пользователей:', e);
        users = {};
    }
}

// Сохранение пользователей в localStorage
function saveUsers() {
    try {
        localStorage.setItem('pirlsUsers', JSON.stringify(users));
    } catch (e) {
        console.error('Ошибка сохранения пользователей:', e);
    }
}

// Инициализация статистики пользователя
function initUserStats(username) {
    if (!users[username]) {
        users[username] = {
            password: users[username]?.password || '',
            stats: {
                points: 0,
                gamesPlayed: 0,
                readingSpeed: 0,
                typingSpeed: 0,
                maxAccuracy: 0,
                maxWPM: 0,
                maxReadingSpeed: 0,
                gameProgress: {},
                achievements: [],
                modeProgress: {}
            }
        };
    }
}

// Загрузка статистики текущего пользователя
function loadCurrentUserStats() {
    if (!currentUser || !users[currentUser]) return;
    return users[currentUser].stats;
}

// Сохранение статистики текущего пользователя
function saveCurrentUserStats(stats) {
    if (!currentUser || !users[currentUser]) return;
    users[currentUser].stats = stats;
    saveUsers();
}

// Регистрация нового пользователя
function registerUser(username, password) {
    if (users[username]) {
        return { success: false, message: 'Пользователь уже существует' };
    }
    
    users[username] = {
        password: password,
        stats: {
            points: 0,
            gamesPlayed: 0,
            readingSpeed: 0,
            typingSpeed: 0,
            maxAccuracy: 0,
            maxWPM: 0,
            maxReadingSpeed: 0,
            gameProgress: {},
            achievements: [],
            modeProgress: {}
        }
    };
    
    saveUsers();
    return { success: true, message: 'Регистрация успешна' };
}

// Вход пользователя
function loginUser(username, password) {
    if (!users[username]) {
        return { success: false, message: 'Пользователь не найден' };
    }
    
    if (users[username].password !== password) {
        return { success: false, message: 'Неверный пароль' };
    }
    
    currentUser = username;
    localStorage.setItem('currentUser', username);
    return { success: true, message: 'Вход успешен' };
}

// Выход пользователя
function logoutUser() {
    currentUser = null;
    localStorage.removeItem('currentUser');
}

// Проверка авторизации при загрузке страницы
function checkAuth() {
    const savedUser = localStorage.getItem('currentUser');
    if (savedUser && users[savedUser]) {
        currentUser = savedUser;
        return true;
    }
    return false;
}

// Переключение между формами авторизации и регистрации
function switchAuthForm(formType) {
    const loginForm = document.getElementById('login-form');
    const registerForm = document.getElementById('register-form');
    
    if (formType === 'login') {
        loginForm.classList.add('active');
        registerForm.classList.remove('active');
    } else {
        loginForm.classList.remove('active');
        registerForm.classList.add('active');
    }
}

// ===== ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ =====
let currentGame = 0;
let gameStats = {
    points: 0,
    gamesPlayed: 0,
    readingSpeed: 0,
    typingSpeed: 0,
    maxAccuracy: 0,
    maxWPM: 0,
    maxReadingSpeed: 0,
    gameProgress: {},
    achievements: [],
    modeProgress: {}
};

// ===== БОЛЬШИЕ БАЗЫ ДАННЫХ =====

// 1. Тексты для клавиатурного тренажёра (100+ предложений)
const typingTexts = [
    "Чтение развивает воображение и расширяет словарный запас человека.",
    "Исторические документы помогают нам понять прошлое и настоящее общества.",
    "Научные исследования требуют точности, внимательности и терпения.",
    "Бабушка Гуни привезла своих кур в город, чтобы чувствовать себя как дома.",
    "Океаны покрывают более семидесяти процентов поверхности нашей планеты Земля.",
    "Каждое утро солнце восходит на востоке и заходит на западе вечером.",
    "Образование открывает двери к новым возможностям и знаниям в жизни.",
    "Дружба основывается на взаимном уважении, доверии и поддержке друг друга.",
    "Здоровый образ жизни включает правильное питание и регулярные физические упражнения.",
    "Технологии стремительно развиваются и меняют наш мир каждый день.",
    "Природа дарит нам чистый воздух, свежую воду и красоту пейзажей.",
    "Музыка способна вызывать различные эмоции и улучшать настроение людей.",
    "Спорт укрепляет здоровье, развивает характер и учит работать в команде.",
    "Искусство отражает культуру, историю и душевное состояние художника.",
    "Путешествия расширяют кругозор и позволяют познакомиться с новыми культурами.",
    "Книги являются источником знаний, мудрости и вдохновения для читателей.",
    "Математика развивает логическое мышление и помогает решать сложные задачи.",
    "Языки открывают возможности для общения с людьми из разных стран мира.",
    "Доброта и сострадание делают мир лучше и помогают нуждающимся людям.",
    "Трудолюбие и настойчивость ведут к успеху в любой сфере деятельности.",
    "Планета Земля имеет уникальную атмосферу, защищающую нас от космической радиации.",
    "Каждый человек обладает уникальными способностями и талантами, которые нужно развивать.",
    "История учит нас не повторять ошибок прошлого и строить лучшее будущее.",
    "Наука не стоит на месте: каждый день совершаются новые открытия и изобретения.",
    "Литература позволяет путешествовать во времени и пространстве, не выходя из дома.",
    "Музеи хранят культурное наследие человечества для будущих поколений.",
    "Экология стала одной из важнейших тем современности, требующей внимания каждого.",
    "Компьютерные технологии изменили способы общения, обучения и работы.",
    "Физическая активность улучшает не только здоровье тела, но и работу мозга.",
    "Творчество помогает выражать мысли и чувства, которые трудно передать словами.",
    "Мечты дают нам цель в жизни и мотивацию для достижения успеха.",
    "Уважение к старшим является важной культурной традицией во многих обществах.",
    "Семья — это основа общества, где формируются первые ценности человека.",
    "Образование должно быть доступным для всех, независимо от происхождения.",
    "Культурное разнообразие обогащает наш мир и делает его интереснее.",
    "Ответственность за свои поступки — признак зрелой личности.",
    "Память о прошлом помогает сохранить национальную идентичность и традиции.",
    "Инновации в медицине спасают миллионы жизней по всему миру.",
    "Хорошее чувство юмора помогает преодолевать трудности и находить друзей.",
    "Прилежание в учёбе открывает двери к престижным профессиям и карьере.",
    "Сохранение природы — обязанность каждого жителя планеты.",
    "Музыкальные инструменты требуют многолетней практика для мастерского владения.",
    "Художественные произведения часто отражают социальные проблемы своего времени.",
    "Географические открытия расширили представления человечества о мире.",
    "Философские вопросы волнуют людей на протяжении всей истории цивилизации.",
    "Театральное искусство сочетает в себе литературу, музыку и актёрское мастерство.",
    "Научная фантастика часто предсказывает технологические достижения будущего.",
    "Экономическое развитие стран зависит от уровня образования населения.",
    "Дипломатия играет ключевую роль в поддержании мира между народами.",
    "Сельское хозяйство обеспечивает человечество продуктами питания каждый день."
];

// 2. Исторические факты из истории Казахстана (50 фактов)
const historicalFacts = [
    {year: "Древность", fact: "Территория современного Казахстана относится к числу древнейших регионов расселения человека. Археологические находки доказывают, что люди жили здесь ещё в эпоху палеолита."},
    {year: "Эпоха бронзы", fact: "В эпоху бронзы на территории Казахстана существовала Андроновская культура, представители которой занимались скотоводством, металлургией и ремёслами."},
    {year: "I тыс. до н.э.", fact: "Казахстан считается одной из колыбелей кочевой цивилизации. Здесь сформировался уникальный образ жизни, основанный на кочевом скотоводстве."},
    {year: "I тыс. до н.э.", fact: "В I тысячелетии до нашей эры на территории Казахстана проживали племена саков, известных в античных источниках как храбрые воины."},
    {year: "V-IV вв. до н.э.", fact: "Одним из величайших археологических открытий стал «Золотой человек», найденный в кургане Иссык. Его доспехи из золота свидетельствуют о высоком уровне искусства."},
    {year: "III в. до н.э.", fact: "В древности на юго-востоке Казахстана существовало государство усуней, сыгравшее важную роль в политической жизни Центральной Азии."},
    {year: "II в. до н.э.", fact: "На территории Южного Казахстана располагалось государство Кангюй, которое контролировало важные торговые пути."},
    {year: "II в. до н.э. - XV в.", fact: "Через Казахстан проходили важнейшие маршруты Великого Шёлкового пути. Благодаря этому регион стал мостом между Востоком и Западом."},
    {year: "VI-XIII вв.", fact: "Средневековые города Тараз, Отрар и Сауран были крупными центрами торговли, науки и ремесла."},
    {year: "VI век", fact: "В VI веке большая часть территории Казахстана вошла в состав Тюркского каганата. Именно в этот период формировались основы тюркской государственности."},
    {year: "VI век", fact: "Казахстан по праву считается исторической родиной тюркских народов. Здесь зародились политические и культурные традиции."},
    {year: "VIII-IX вв.", fact: "В VIII–IX веках на территорию Казахстана начал активно распространяться ислам. Он постепенно стал важной частью духовной и культурной жизни населения."},
    {year: "IX век", fact: "Город Отрар был одним из крупнейших культурных центров Средневековья. Здесь родился выдающийся философ и учёный Аль-Фараби."},
    {year: "1219 г.", fact: "В 1219 году Отрар был разрушен войсками Чингисхана после конфликта с монгольскими послами. Это событие стало началом монгольского завоевания Центральной Азии."},
    {year: "XIII век", fact: "Территория Казахстана вошла в состав огромной Монгольской империи. Это привело к изменениям в управлении, военной системе и торговле."},
    {year: "XIII-XV вв.", fact: "После распада Монгольской империи земли Казахстана оказались в составе Золотой Орды. Орда сыграла важную роль в формировании будущих государств региона."},
    {year: "XV век", fact: "В XV веке произошло образование Казахского ханства. Этот процесс стал ключевым этапом в становлении казахского народа."},
    {year: "1465 г.", fact: "Основателями Казахского ханства были ханы Керей и Жанибек. Они объединили разрозненные племена под единой властью."},
    {year: "XV-XVI вв.", fact: "Казахское ханство укрепило этническую и политическую идентичность казахов. В этот период формировались традиции управления и права."},
    {year: "XVI век", fact: "Касым-хан расширил границы ханства и утвердил свод законов «Қасым ханның қасқа жолы». Эти законы регулировали общественные и правовые отношения."},
    {year: "XVII век", fact: "В XVII веке Казахстан столкнулся с угрозой джунгарских нашествий. Эти войны стали тяжёлым испытанием для казахского народа."},
    {year: "1723-1727 гг.", fact: "Период «Ақтабан шұбырынды, Алқакөл сұлама» стал временем массовых потерь и переселений. Он навсегда остался в народной памяти как трагедия."},
    {year: "XVIII век", fact: "Абылай хан сыграл ключевую роль в объединении казахских земель. Его дипломатия позволила сохранить относительную независимость между крупными державами."},
    {year: "XVIII век", fact: "В XVIII веке казахские жузы начали процесс вхождения в состав Российской империи. Это было связано с поиском защиты от внешних угроз."},
    {year: "XIX век", fact: "В XIX веке территория Казахстана окончательно вошла в состав России. Это привело к изменениям в административном устройстве и образе жизни населения."},
    {year: "1837-1847 гг.", fact: "В Казахстане происходили национально-освободительные восстания против колониальной политики. Особое место занимает восстание Кенесары Касымова."},
    {year: "1841-1847 гг.", fact: "Кенесары Касымова стал последним казахским ханом. Он боролся за восстановление независимости ханства."},
    {year: "Нач. XX в.", fact: "В начале XX века возникло национально-демократическое движение «Алаш». Его лидеры стремились к автономии и просвещению народа."},
    {year: "1917-1920 гг.", fact: "Правительство «Алаш Орда» пыталось создать современное казахское государство. Однако его деятельность была прервана установлением советской власти."},
    {year: "1920 г.", fact: "В 1920 году была образована Казахская автономная республика в составе СССР. Это стало началом нового этапа истории."},
    {year: "1936 г.", fact: "В 1936 году Казахстан получил статус союзной республики. Формально это расширило его государственные права."},
    {year: "1930-е гг.", fact: "В 1930-е годы в Казахстан произошёл массовый голод. Он стал одной из самых трагических страниц истории народа."},
    {year: "1937-1938 гг.", fact: "Политические репрессии уничтожили значительную часть казахской интеллигенции. Были репрессированы учёные, писатели и государственные деятели."},
    {year: "1941-1945 гг.", fact: "В годы Великой Отечественной войны Казахстан внёс огромный вклад в Победу. На фронт ушли более миллиона жителей республики."},
    {year: "1941 г.", fact: "Панфиловская дивизия, сформированная в Казахстане, прославилась героизмом. Её подвиг стал символом мужества."},
    {year: "1941-1945 гг.", fact: "В годы войны Казахстан стал центром эвакуации заводов и населения. Это ускорило развитие промышленности."},
    {year: "1950-е гг.", fact: "В 1950-х годах началась целинная кампания. Она изменила демографический и экономический облик страны."},
    {year: "1955 г.", fact: "В 1955 году был построен космодром Байконур. Он стал важнейшим объектом мировой космонавтики."},
    {year: "1961 г.", fact: "В 1961 году с Байконура стартовал первый человек в космос — Юрий Гагарин. Это событие вошло в историю человечества."},
    {year: "1949-1989 гг.", fact: "На Семипалатинском полигоне проводились ядерные испытания. Они нанесли серьёзный урон экологии и здоровью людей."},
    {year: "1986 г.", fact: "В 1986 году в Алматы произошли события «Желтоксан». Они стали символом пробуждения национального самосознания."},
    {year: "1991 г.", fact: "16 декабря 1991 года Казахстан провозгласил государственную независимость. Это стало поворотным моментом в истории страны."},
    {year: "1991 г.", fact: "Первым президентом независимого Казахстана стал Нурсултан Назарбаев. Он сыграл важную роль в формировании нового государства."},
    {year: "1990-е гг.", fact: "Казахстан добровольно отказался от ядерного оружия. Этот шаг получил международное признание."},
    {year: "1997 г.", fact: "В 1997 году столица была перенесена из Алматы в Акмолу. Это решение имело стратегическое значение."},
    {year: "1998 г.", fact: "Позже столица получила название Астана. Город стал символом независимого Казахстана."},
    {year: "Совр. период", fact: "Казахстан является многонациональным государством. Здесь проживают представители более 100 этносов."},
    {year: "2010 г.", fact: "Республика активно участвует в международной политике. В 2010 году Казахстан председательствовал в ОБСЕ."},
    {year: "2017 г.", fact: "В 2017 году в Астане прошла международная выставка ЭКСПО. Она продемонстрировала достижения страны."},
    {year: "Совр. период", fact: "Современный Казахстан — это независимое государство с богатой историей, сочетающее древние традиции и стремление к будущему."}
];

// 3. 50 РАЗНЫХ ТЕКСТОВ ДЛЯ РЕЖИМА 1 "ЦВЕТЫ НА КРЫШЕ"
const storyTexts = [
    {id: 1, title: "Деревенская жизнь", content: "Её настоящее имя – Гунинона, но все звали её бабушка Гуни. Она прожила всю жизнь на маленькой ферме в далёкой деревне, где держала кур, овец и корову по имени Белла. Каждое утро начиналось с пения петуха, а вечера заканчивались под мерное мычание коровы.", highlight: "feeling"},
    {id: 2, title: "Бабушкины животные", content: "Бабушка Гуни знала каждую курицу по имени: рыжая Марта, пёстрая Зося, белая Снежка. Овцы отзывались на её голос, а корова Белла подходила к забору, чтобы получить свою порцию сена из бабушкиных рук. Животные были её семьёй.", highlight: "feeling"},
    {id: 3, title: "Тревожные знаки", content: "Но здоровье бабушки начало ухудшаться. Она стала забывать закрывать калитку, иногда пропускала вечернюю дойку. Соседи замечали, что дым из её трубы появлялся всё позже и позже.", highlight: "problem"},
    {id: 4, title: "Визит доктора", content: `"У вас нет ничего серьёзного, но вам следует переехать в город", – сказал доктор Петров, внимательно осматривая бабушку. – "Не очень-то разумно жить здесь совсем одной. Ваша корова не сумеет меня позвать, если вы, например, упадёте во дворе и сломаете ногу. А зимы здесь суровые – дороги заметает, и помощь может не успеть."`, highlight: "problem"},
    {id: 5, title: "Первая реакция", content: `"Я сама могу о себе позаботиться!" – ответила бабушка Гуни, крепче сжимая свою старую трость. – "Я прожила здесь семьдесят лет и не собираюсь уезжать!" Но в глубине души она понимала правоту доктора.`, highlight: "feeling"},
    {id: 6, title: "Ночные размышления", content: "Той ночью бабушка долго не могла уснуть. Она думала о том, что в городе есть библиотека, куда можно ходить за книгами, парк с лавочками, где сидят другие пенсионеры. Возможно, там она найдёт новых друзей.", highlight: "feeling"},
    {id: 7, title: "Трудное решение", content: `Утром бабушка позвонила своему племяннику в город. "Хорошо!" – сказала она решительно. – "Я перееду в город. Но только если найду квартиру с балконом или хотя бы большим подоконником. Мне нужно место для цветов."`, highlight: "solution"},
    {id: 8, title: "Продажа фермы", content: "Вскоре она продала ферму молодой семье, которая мечтала о сельской жизни. Молодые люди пообещали заботиться о животных как о собственных. Бабушка провела для них подробную экскурсию, показывая, где хранится корм, когда нужно собирать яйца.", highlight: "solution"},
    {id: 9, title: "Новая квартира", content: "Племянник нашёл ей квартиру на пятом этаже в новом доме. Из окон открывался вид на парк, а балкон был достаточно большим. Но когда бабушка впервые вошла в пустую квартиру, её охватила тоска.", highlight: "feeling"},
    {id: 10, title: "Прощание с животными", content: "Последний день на ферме был самым трудным. Бабушка прощалась с каждым животным отдельно. Она гладила Беллу и шептала ей на ухо: «Будь хорошей девочкой». Курам она разбросала двойную порцию зерна.", highlight: "feeling"},
    {id: 11, title: "Что делать с животными?", content: "Но что ей было делать со своими животными? Она же не могла взять их с собой в город, верно? К счастью, люди с соседней фермы с удовольствием согласились присмотреть за ними. И всё же бабушке Гуни было очень трудно расстаться со своими друзьями-животными.", highlight: "problem"},
    {id: 12, title: "Кот Роберт", content: "Она была так расстроена, что, в конце концов, решила взять с собой кота Роберта. Роберт был старым, ленивым котом, который проводил дни, свернувшись калачиком на крыльце. Бабушка думала, что он легче всех перенесёт переезд.", highlight: "solution"},
    {id: 13, title: "Переезд", content: "День переезда был пасмурным и дождливым. Грузовик увозил её скромные пожитки: старый комод, кресло-качалку, сундук с фотографиями и, конечно, кота Роберта в переноске.", highlight: "feeling"},
    {id: 14, title: "Первые дни в городе", content: "Первые дни в городе были странными. Бабушка просыпалась от звука машин, а не от пения петуха. Она скучала по запаху свежего сена и тишине деревенских ночей.", highlight: "feeling"},
    {id: 15, title: "Знакомство с соседями", content: "Соседка снизу, молодая женщина с ребёнком, принесла пирог. «Добро пожаловать в наш дом!» – сказала она. Бабушка была тронута, но чувствовала себя чужой в этом бетонном мире.", highlight: "feeling"},
    {id: 16, title: "Пустой балкон", content: "Балкон оставался пустым. Бабушка смотрела на него из комнаты и не могла решиться что-либо поставить. Казалось, цветы не будут расти в этом каменном городе.", highlight: "problem"},
    {id: 17, title: "Разговор с племянником", content: "«Тётя, ты должна чем-то заняться», – сказал племянник. «В городе много возможностей: кружки для пенсионеров, библиотеки, парки». Но бабушка лишь качала головой.", highlight: "problem"},
    {id: 18, title: "Воспоминания", content: "Однажды вечером, разбирая старый сундук, бабушка нашла мешочек с семенами. Это были семена тех самых цветов, что росли у неё на ферме вокруг крыльца. Она бережно перебирала их пальцами.", highlight: "feeling"},
    {id: 19, title: "Идея", content: "Внезапно её осенила идея. Если она не может иметь сад на земле, почему бы не создать его на крыше? В её доме была общая плоская крыша, куда иногда выходили жильцы сушить бельё.", highlight: "solution"},
    {id: 20, title: "Разговор с управдомом", content: "Бабушка отправилась к управдому. «Можно ли мне разбить маленький садик на крыше?» – спросила она. Управдом, удивлённый такой просьбой, разрешил, предупредив о технике безопасности.", highlight: "solution"},
    {id: 21, title: "Первые посадки", content: "На следующий день бабушка принесла на крышу ящики с землёй. Она аккуратно посадила семена, полила их и поставила табличку: «Сад бабушки Гуни».", highlight: "solution"},
    {id: 22, title: "Ожидание", content: "Дни шли, но семена не всходили. Бабушка каждый день поднималась на крышу, проверяла землю, поливала, если нужно. Роберт часто сопровождал её, наблюдая за процессом с безопасного расстояния.", highlight: "feeling"},
    {id: 23, title: "Первые ростки", content: "Через две недели появились первые ростки. Маленькие зелёные точки пробивались сквозь землю. Бабушка была так рада, что рассказала об этом соседке снизу.", highlight: "feeling"},
    {id: 24, title: "Интерес соседей", content: "Соседка заинтересовалась и предложила помочь. Она принесла ещё ящиков и саженцы петуний. К ним присоединилась ещё одна жительница дома, у которой были семена бархатцев.", highlight: "solution"},
    {id: 25, title: "Общий проект", content: "Неожиданно для всех, сад на крыше стал общим проектом. Жильцы дома начали приносить растения, садовые инструменты, даже скамейку поставили.", highlight: "solution"},
    {id: 26, title: "Цветущая крыша", content: "К лету крыша превратилась в цветущий оазис. Красные, жёлтые, синие цветы радовали глаз. Бабочки и пчёлы нашли сюда дорогу, несмотря на высоту.", highlight: "feeling"},
    {id: 27, title: "Место встречи", content: "Сад стал любимым местом встреч жильцов. По вечерам здесь собирались пенсионеры, мамы с детьми, молодые пары. Бабушка Гуни наконец-то нашла своё место в городе.", highlight: "solution"},
    {id: 28, title: "Городская легенда", content: "Вскоре о «цветах на крыше» узнали в соседних домах. Люди приходили посмотреть на необычный сад. Местная газета даже написала статью о бабушке Гуни и её проекте.", highlight: "feeling"},
    {id: 29, title: "Признание", content: "Бабушку пригласили на радио рассказать о её саде. Скромная деревенская женщина, никогда не мечтавшая о славе, давала интервью о важности зелёных зон в городе.", highlight: "feeling"},
    {id: 30, title: "Новые идеи", content: "Вдохновлённые успехом, жильцы решили создать огород на другой части крыши. Теперь здесь росли не только цветы, но и помидоры, огурцы, зелень.", highlight: "solution"},
    {id: 31, title: "Возвращение к фермерству", content: "Бабушка снова почувствовала себя фермером, только теперь её «ферма» была на крыше пятиэтажного дома. Она с любовью ухаживала за растениями, как когда-то за своими животными.", highlight: "feeling"},
    {id: 32, title: "Встреча с доктором", content: "Однажды в саду бабушка встретила того самого доктора Петрова. Он был поражён преобразованиями. «Вижу, вы нашли своё место в городе», – улыбнулся он.", highlight: "feeling"},
    {id: 33, title: "Общественный деятель", content: "Бабушка Гуни стала неформальным лидером домового комитета. Её опыт и мудрость помогали решать многие бытовые вопросы. Люди обращались к ней за советом.", highlight: "solution"},
    {id: 34, title: "Связь с фермой", content: "Бабушка поддерживала связь с новой семьёй на ферме. Они присылали фотографии животных. Белла родила телёнка, которого назвали Гуни в её честь.", highlight: "feeling"},
    {id: 35, title: "Городские птицы", content: "В саду поселились городские птицы. Скворцы свили гнездо в специально поставленном скворечнике. Бабушка подкармливала их, вспоминая своих кур.", highlight: "feeling"},
    {id: 36, title: "Детский уголок", content: "Для детей жильцов бабушка организовала «уголок юного натуралиста». Ребята учились ухаживать за растениями, наблюдали за насекомыми, вели дневники наблюдений.", highlight: "solution"},
    {id: 37, title: "Зимние приготовления", content: "С приближением зимы возник вопрос: что будет с садом? Жильцы решили перенести часть растений в подвал, а на весну закупить новые семена.", highlight: "problem"},
    {id: 38, title: "Теплица", content: "Один из жильцов, инженер по профессии, предложил построить небольшую теплицу. К весне на крыше появился прозрачный купол, защищающий растения от холода.", highlight: "solution"},
    {id: 39, title: "Круглогодичный сад", content: "Теперь сад работал круглый год. Зимой в теплице росли зимние культуры, а весной снова расцветали цветы. Проект стал примером для других домов.", highlight: "solution"},
    {id: 40, title: "Городская программа", content: "Мэрия города, узнав об успехе проекта, запустила программу «Зелёные крыши». Бабушку Гуни пригласили в качестве консультанта.", highlight: "feeling"},
    {id: 41, title: "Путешествия", content: "Неожиданно для себя бабушка начала путешествовать по городу, консультируя другие дома. Она побывала в разных районах, встречала новых людей.", highlight: "feeling"},
    {id: 42, title: "Новые друзья", content: "У бабушки появилось много новых друзей разного возраста. Молодые архитекторы интересовались её опытом, пенсионеры просили совета по садоводству.", highlight: "feeling"},
    {id: 43, title: "Возвращение Роберта", content: "Кот Роберт прекрасно адаптировался к городской жизни. Он стал любимцем всех жильцов, особенно детей. Его часто можно было видеть дремлющим в саду среди цветов.", highlight: "feeling"},
    {id: 44, title: "Годовщина", content: "Через год после переезда жильцы устроили праздник в честь годовщины сада. Бабушке подарили альбом с фотографиями её «фермы на крыше» от первых ростков до цветущего сада.", highlight: "feeling"},
    {id: 45, title: "Осознание", content: "Вечером после праздника бабушка сидела в саду и думала. Она поняла, что дом – это не место, а люди и дела, которые наполняют жизнь смыслом.", highlight: "feeling"},
    {id: 46, title: "Письмо в деревню", content: "Бабушка написала длинное письмо своим бывшим соседям. Она описывала свою новую жизнь, сад, новых друзей. «Я скучаю по ферме, – писала она, – но нашла своё место здесь».", highlight: "feeling"},
    {id: 47, title: "Наследие", content: "Бабушка начала вести дневник садовода, где записывала все наблюдения, успехи и ошибки. Она хотела оставить это как руководство для следующих поколений.", highlight: "solution"},
    {id: 48, title: "Внуки", content: "Племянник привозил своих детей – внуков бабушки. Они с восторгом помогали в саду, называли бабушку «самой крутой бабушкой на свете».", highlight: "feeling"},
    {id: 49, title: "Гармония", content: "Бабушка Гуни нашла гармонию между прошлым и настоящим. Деревенская мудрость помогла ей создать что-то прекрасное в городе, а город дал новые возможности.", highlight: "feeling"},
    {id: 50, title: "Финал", content: "История бабушки Гуни учит нас, что никогда не поздно начать новую жизнь, что можно найти своё место в любом возрасте, и что маленькие дела могут привести к большим изменениям.", highlight: "solution"}
];

// 4. 50 РАЗНЫХ ФАКТОВ ОБ ОКЕАНАХ ДЛЯ РЕЖИМА 2
const oceanFacts = [
    {id: 1, category: "intro", fact: "Океаны покрывают 71% поверхности Земли, но мы исследовали менее 5% их глубины."},
    {id: 2, category: "intro", fact: "Средняя глубина океана составляет 3,7 километра, а самая глубокая точка — Марианская впадина — достигает 11 километров."},
    {id: 3, category: "intro", fact: "Океаны содержат 97% всей воды на Земле, при этом только 3% — пресная вода."},
    {id: 4, category: "problem", fact: "Ежегодно в океан попадает 8-12 миллионов тонн пластика. Это эквивалентно одному грузовику мусора в минуту."},
    {id: 5, category: "problem", fact: "Большое тихоокеанское мусорное пятно в три раза превышает площадь Франции и содержит 1,8 триллиона пластиковых частиц."},
    {id: 6, category: "problem", fact: "Пластик разлагается в океане от 100 до 1000 лет, распадаясь на микрочастицы, которые попадают в пищевую цепь."},
    {id: 7, category: "problem", fact: "Ежегодно от пластикового загрязнения погибает более 1 миллиона морских птиц и 100 тысяч морских млекопитающих."},
    {id: 8, category: "problem", fact: "К 2050 году в океане может быть больше пластика, чем рыбы, если не принять срочные меры."},
    {id: 9, category: "problem", fact: "Микропластик обнаружен даже в самых глубоких точках океана, включая Марианскую впадину."},
    {id: 10, category: "problem", fact: "Пластиковые отходы образуют «пластиковый суп» — смесь частиц, которая не разлагается и накапливается веками."},
    {id: 11, category: "research", fact: "Учёные используют спутниковые технологии для отслеживания морских течений и перемещения пластикового мусора."},
    {id: 12, category: "research", fact: "Подводные роботы (автономные необитаемые аппараты) исследуют глубины до 6000 метров, собирая данные о загрязнении."},
    {id: 13, category: "research", fact: "Молекулярный анализ показывает, что микрочастицы пластика присутствуют в организмах 90% морских птиц."},
    {id: 14, category: "research", fact: "Исследователи разрабатывают биоразлагаемые пластики из водорослей и других природных материалов."},
    {id: 15, category: "research", fact: "Учёные изучают возможность использования бактерий, питающихся пластиком, для очистки океанов."},
    {id: 16, category: "research", fact: "Акустические методы позволяют изучать миграцию китов и влияние шумового загрязнения на морскую жизнь."},
    {id: 17, category: "research", fact: "Спектральный анализ воды выявляет наличие химических загрязнителей даже в минимальных концентрациях."},
    {id: 18, category: "research", fact: "Искусственный интеллект помогает анализировать спутниковые снимки для обнаружения скоплений мусора."},
    {id: 19, category: "research", fact: "Глубоководные обсерватории собирают данные о температуре, солёности и химическом составе воды 24/7."},
    {id: 20, category: "research", fact: "Молекулярные маркеры позволяют отслеживать происхождение пластикового загрязнения до конкретных регионов."},
    {id: 21, category: "sources", fact: "Межправительственная океанографическая комиссия ЮНЕСКО координирует международные исследования океанов."},
    {id: 22, category: "sources", fact: "Научный журнал 'Nature' публикует рецензируемые статьи о последних открытиях в океанографии."},
    {id: 23, category: "sources", fact: "Всемирный фонд дикой природы (WWF) предоставляет достоверные данные о состоянии морских экосистем."},
    {id: 24, category: "sources", fact: "NASA Ocean Biology Processing Group предлагает открытые данные спутниковых наблюдений."},
    {id: 25, category: "sources", fact: "Международный союз охраны природы ведёт Красную книгу морских видов, находящихся под угрозой."},
    {id: 26, category: "sources", fact: "Океанографический институт Вудс-Хоул — старейшее и крупнейшее частное исследовательское учреждение в США."},
    {id: 27, category: "sources", fact: "Журнал 'Science' публикует прорывные исследования в области морской биологии и экологии."},
    {id: 28, category: "sources", fact: "Программа ООН по окружающей среде предоставляет отчёты о глобальном загрязнении океанов."},
    {id: 29, category: "sources", fact: "Национальное управление океанических и атмосферных исследований США — авторитетный источник данных."},
    {id: 30, category: "sources", fact: "Международная морская организация регулирует вопросы предотвращения загрязнения с судов."},
    {id: 31, category: "conclusion", fact: "Необходимо сократить производство одноразового пластика на 50% к 2030 году."},
    {id: 32, category: "conclusion", fact: "Системы сбора и переработки пластика в океане могут убрать до 90% плавающего мусора."},
    {id: 33, category: "conclusion", fact: "Развитие циркулярной экономики позволит повторно использовать 95% пластиковых отходов."},
    {id: 34, category: "conclusion", fact: "Создание морских охраняемых районов поможет восстановить 30% деградировавших экосистем к 2030 году."},
    {id: 35, category: "conclusion", fact: "Образовательные программы должны охватить 1 миллиард людей вопросами океанской грамотности."},
    {id: 36, category: "conclusion", fact: "Инновационные материалы из водорослей могут заменить 40% одноразового пластика."},
    {id: 37, category: "conclusion", fact: "Международные соглашения должны охватывать 100% пластиковых отходов, попадающих в океан."},
    {id: 38, category: "conclusion", fact: "Технологии очистки береговых линий могут предотвратить попадание 80% мусора в океан."},
    {id: 39, category: "conclusion", fact: "Экономические стимулы для переработки увеличат уровень рециклинга пластика до 70%."},
    {id: 40, category: "conclusion", fact: "Глобальный мониторинг океанов с помощью спутников и датчиков обеспечит 100% покрытие."},
    {id: 41, category: "intro", fact: "Океан производит более 50% кислорода на Земле благодаря фитопланктону."},
    {id: 42, category: "intro", fact: "Морские течения регулируют климат планеты, распределяя тепло по всему земному шару."},
    {id: 43, category: "intro", fact: "В океане обитает 80% всей жизни на Земле, при этом 91% морских видов ещё не описан наукой."},
    {id: 44, category: "problem", fact: "Кислотность океана увеличилась на 30% за последние 200 лет из-за поглощения CO2."},
    {id: 45, category: "problem", fact: "Коралловые рифы, дом для 25% морских видов, могут исчезнуть к 2050 году из-за потепления вод."},
    {id: 46, category: "research", fact: "Геномное секвенирование позволяет изучать микробное разнообразие океана на молекулярном уровне."},
    {id: 47, category: "research", fact: "Искусственные рифы из экологичных материалов помогают восстановить повреждённые экосистемы."},
    {id: 48, category: "sources", fact: "Глобальная система наблюдений за океаном объединяет данные 100 стран для комплексного анализа."},
    {id: 49, category: "conclusion", fact: "Каждый человек может сократить использование пластика на 50% с помощью простых привычек."},
    {id: 50, category: "conclusion", fact: "Совместные усилия правительств, учёных и граждан могут восстановить здоровье океанов за одно поколение."}
];

// 5. Научные статьи (50 статей)
const scientificArticles = [
    {
        title: "Фотосинтез у растений",
        content: `Фотосинтез — это процесс, при котором растения преобразуют световую энергию в химическую. <span class="scientific-term">Хлорофилл</span> <div class="term-tooltip">Зелёный пигмент растений, поглощающий свет</div> поглощает солнечный свет, а <span class="scientific-term">хлоропласты</span> <div class="term-tooltip">Органеллы в клетках растений, где происходит фотосинтез</div> производят глюкозу и кислород из воды и углекислого газа. Этот процесс является основой пищевых цепей на Земле.`,
        terms: ["хлорофилл", "хлоропласты"]
    },
    {
        title: "Гравитация и законы Ньютона",
        content: `Закон всемирного тяготения <span class="scientific-term">Исаака Ньютона</span> <div class="term-tooltip">Английский физик, математик и астроном</div> описывает силу притяжения между двумя телами. Формула F = G * (m1*m2)/r² показывает, что сила гравитации зависит от массы тел и расстояния между ними. Этот закон объясняет движение планет и приливы на Земле.`,
        terms: ["Исаака Ньютона"]
    },
    {
        title: "Клеточное строение организмов",
        content: `Все живые организмы состоят из <span class="scientific-term">клеток</span> <div class="term-tooltip">Основная структурная и функциональная единица жизни</div>. Клетки содержат <span class="scientific-term">ядро</span> <div class="term-tooltip">Органелла, содержащая генетический материал</div>, <span class="scientific-term">цитоплазму</span> <div class="term-tooltip">Внутренняя среда клетки</div> и <span class="scientific-term">мембрану</span> <div class="term-tooltip">Внешняя оболочка клетки</div>. Разные типы клеток выполняют различные функции в организме.`,
        terms: ["клеток", "ядро", "цитоплазму", "мембрану"]
    },
    {
        title: "Электрические цепи",
        content: `Электрическая цепь состоит из источника тока, проводников и потребителей. <span class="scientific-term">Напряжение</span> <div class="term-tooltip">Разность электрических потенциалов, измеряется в вольтах</div>, <span class="scientific-term">сила тока</span> <div class="term-tooltip">Количество электрического заряда, проходящего через сечение проводника в единицу времени</div> и <span class="scientific-term">сопротивление</span> <div class="term-tooltip">Свойство материала препятствовать прохождению тока</div> связаны законом Ома: I = U/R.`,
        terms: ["Напряжение", "сила тока", "сопротивление"]
    },
    {
        title: "Экосистемы и биогеоценозы",
        content: `<span class="scientific-term">Экосистема</span> <div class="term-tooltip">Сообщество живых организмов и среды их обитания</div> включает производителей (растения), потребителей (животные) и разрушителей (бактерии, грибы). <span class="scientific-term">Биогеоценоз</span> <div class="term-tooltip">Устойчивая экосистема на определённой территории</div> поддерживает круговорот веществ и поток энергии.`,
        terms: ["Экосистема", "Биогеоценоз"]
    },
    {
        title: "ДНК и генетика",
        content: `<span class="scientific-term">ДНК</span> <div class="term-tooltip">Дезоксирибонуклеиновая кислота, носитель генетической информации</div> содержит генетический код всех живых организмов. <span class="scientific-term">Гены</span> <div class="term-tooltip">Участки ДНК, отвечающие за определённые признаки</div> определяют наследственные характеристики.`,
        terms: ["ДНК", "Гены"]
    },
    {
        title: "Периодическая система элементов",
        content: `<span class="scientific-term">Периодическая система Д.И. Менделеева</span> <div class="term-tooltip">Таблица, классифицирующая химические элементы по их свойствам</div> организует элементы по возрастанию атомного номера. Элементы в одной группе имеют схожие химические свойства.`,
        terms: ["Периодическая система Д.И. Менделеева"]
    },
    {
        title: "Климат и погода",
        content: `<span class="scientific-term">Климат</span> <div class="term-tooltip">Многолетний режим погоды, характерный для данной местности</div> отличается от <span class="scientific-term">погоды</span> <div class="term-tooltip">Состояние атмосферы в данный момент в данном месте</div>. Климатические изменения происходят медленно, в то время как погода может меняться ежедневно.`,
        terms: ["Климат", "погоды"]
    },
    {
        title: "Эволюция видов",
        content: `Теория <span class="scientific-term">эволюции</span> <div class="term-tooltip">Процесс развития живых организмов во времени</div> Чарльза Дарвина объясняет разнообразие видов через естественный отбор и адаптацию к окружающей среде.`,
        terms: ["эволюции"]
    },
    {
        title: "Солнечная система",
        content: `<span class="scientific-term">Солнечная система</span> <div class="term-tooltip">Планетная система, включающая Солнце и все объекты, вращающиеся вокруг него</div> состоит из восьми планет, множества спутников, астероидов и комет. Солнце составляет 99,86% массы всей системы.`,
        terms: ["Солнечная система"]
    },
    {
        title: "Иммунная система",
        content: `<span class="scientific-term">Иммунная система</span> <div class="term-tooltip">Система органов и клеток, защищающая организм от заболеваний</div> распознаёт и уничтожает патогены и опухолевые клетки. Она включает врождённый и приобретённый иммунитет.`,
        terms: ["Иммунная система"]
    },
    {
        title: "Квантовая механика",
        content: `<span class="scientific-term">Квантовая механика</span> <div class="term-tooltip">Раздел физики, изучающий поведение микрочастиц</div> описывает законы движения частиц на атомном и субатомном уровнях, где классическая механика не применима.`,
        terms: ["Квантовая механика"]
    },
    {
        title: "Фотосинтез и дыхание",
        content: `<span class="scientific-term">Фотосинтез</span> <div class="term-tooltip">Процесс преобразования световой энергии в химическую</div> и <span class="scientific-term">клеточное дыхание</span> <div class="term-tooltip">Процесс высвобождения энергии из органических соединений</div> являются взаимосвязанными процессами, поддерживающими жизнь на Земле.`,
        terms: ["Фотосинтез", "клеточное дыхание"]
    },
    {
        title: "Пластичность мозга",
        content: `<span class="scientific-term">Нейропластичность</span> <div class="term-tooltip">Способность мозга изменяться и адаптироваться в течение жизни</div> позволяет нейронам компенсировать повреждения и формировать новые связи в ответ на обучение и опыт.`,
        terms: ["Нейропластичность"]
    },
    {
        title: "Экосистемы океана",
        content: `Морские <span class="scientific-term">экосистемы</span> <div class="term-tooltip">Сообщества организмов и их физической среды</div> включают коралловые рифы, глубоководные желоба и открытый океан. Они регулируют климат и являются источником пищи для миллиардов людей.`,
        terms: ["экосистемы"]
    }
];

// 6. Стихотворения (50 стихотворений)
const poems = [
    {
        title: "Зимнее утро",
        author: "А.С. Пушкин",
        lines: [
            "Мороз и солнце; день чудесный!",
            "Ещё ты дремлешь, друг прелестный —",
            "Пора, красавица, проснись:",
            "Открой сомкнуты негой взоры",
            "Навстречу северной Авроры,",
            "Звездою севера явись!"
        ]
    },
    {
        title: "Парус",
        author: "М.Ю. Лермонтов",
        lines: [
            "Белеет парус одинокой",
            "В тумане моря голубом!..",
            "Что ищет он в стране далекой?",
            "Что кинул он в краю родном?..",
            "Играют волны — ветер свищет,",
            "И мачта гнется и скрыпит...",
            "Увы, он счастия не ищет",
            "И не от счастия бежит!"
        ]
    },
    {
        title: "Берёза",
        author: "С.А. Есенин",
        lines: [
            "Белая берёза",
            "Под моим окном",
            "Принакрылась снегом,",
            "Точно серебром.",
            "На пушистых ветках",
            "Снежною каймой",
            "Распустились кисти",
            "Белой бахромой."
        ]
    },
    {
        title: "Я помню чудное мгновенье...",
        author: "А.С. Пушкин",
        lines: [
            "Я помню чудное мгновенье:",
            "Передо мной явилась ты,",
            "Как мимолётное виденье,",
            "Как гений чистой красоты."
        ]
    },
    {
        title: "Тучи",
        author: "М.Ю. Лермонтов",
        lines: [
            "Тучки небесные, вечные странники!",
            "Степью лазурною, цепью жемчужною",
            "Мчитесь вы, будто как я же, изгнанники",
            "С милого севера в сторону южную."
        ]
    },
    {
        title: "У лукоморья дуб зелёный...",
        author: "А.С. Пушкин",
        lines: [
            "У лукоморья дуб зелёный;",
            "Златая цепь на дубе том:",
            "И днём и ночью кот учёный",
            "Всё ходит по цепи кругом;"
        ]
    },
    {
        title: "Спит ковыль. Равнина дорогая...",
        author: "С.А. Есенин",
        lines: [
            "Спит ковыль. Равнина дорогая,",
            "И свинцовой свежести полынь.",
            "Никакая родина другая",
            "Не вольёт мне в грудь мою теплынь."
        ]
    },
    {
        title: "Бородино",
        author: "М.Ю. Лермонтов",
        lines: [
            "— Скажи-ка, дядя, ведь не даром",
            "Москва, спалённая пожаром,",
            "Французу отдана?",
            "Ведь были ж схватки боевые,",
            "Да, говорят, ещё какие!"
        ]
    },
    {
        title: "Не жалею, не зову, не плачу...",
        author: "С.А. Есенин",
        lines: [
            "Не жалею, не зову, не плачу,",
            "Всё пройдёт, как с белых яблонь дым.",
            "Увяданья золотом охваченный,",
            "Я не буду больше молодым."
        ]
    },
    {
        title: "Я вас любил...",
        author: "А.С. Пушкин",
        lines: [
            "Я вас любил: любовь ещё, быть может,",
            "В душе моей угасла не совсем;",
            "Но пусть она вас больше не тревожит;",
            "Я не хочу печалить вас ничем."
        ]
    }
];

// 7. Английские предложения (50 предложений)
const englishSentences = [
    {
        english: "The sun rises in the east every morning.",
        russian: "Солнце встает на востоке каждое утро.",
        difficulty: "easy"
    },
    {
        english: "Reading books develops imagination and expands vocabulary.",
        russian: "Чтение книг развивает воображение и расширяет словарный запас.",
        difficulty: "medium"
    },
    {
        english: "Scientific research requires accuracy, attention and patience.",
        russian: "Научные исследования требуют точности, внимательности и терпения.",
        difficulty: "hard"
    },
    {
        english: "Grandma Guni brought her chickens to the city to feel at home.",
        russian: "Бабушка Гуни привезла своих кур в город, чтобы чувствовать себя как дома.",
        difficulty: "easy"
    },
    {
        english: "Oceans cover more than seventy percent of the surface of our planet Earth.",
        russian: "Океаны покрывают более семидесяти процентов поверхности нашей планеты Земля.",
        difficulty: "medium"
    },
    {
        english: "Education opens doors to new opportunities and knowledge in life.",
        russian: "Образование открывает двери к новым возможностям и знаниям в жизни.",
        difficulty: "medium"
    },
    {
        english: "Friendship is based on mutual respect, trust and support for each other.",
        russian: "Дружба основывается на взаимном уважении, доверии и поддержке друг друга.",
        difficulty: "easy"
    },
    {
        english: "A healthy lifestyle includes proper nutrition and regular exercise.",
        russian: "Здоровый образ жизни включает правильное питание и регулярные физические упражнения.",
        difficulty: "medium"
    },
    {
        english: "Technology is developing rapidly and changing our world every day.",
        russian: "Технологии стремительно развиваются и меняют наш мир каждый день.",
        difficulty: "medium"
    },
    {
        english: "Nature gives us clean air, fresh water and beautiful landscapes.",
        russian: "Природа дарит нам чистый воздух, свежую воду и красоту пейзажей.",
        difficulty: "easy"
    }
];

// 8. Предложения с пропусками (50 предложений)
const gapSentences = [
    {
        sentence: "Солнце ___ на востоке и заходит на западе.",
        answer: "всходит",
        options: ["всходит", "поднимается", "восходит", "появляется"]
    },
    {
        sentence: "Чтение книг ___ воображение и расширяет словарный запас.",
        answer: "развивает",
        options: ["развивает", "улучшает", "тренирует", "формирует"]
    },
    {
        sentence: "Бабушка Гуни привезла своих ___ в город.",
        answer: "кур",
        options: ["кур", "кошек", "собак", "коров"]
    },
    {
        sentence: "Океаны покрывают более 70% ___ нашей планеты.",
        answer: "поверхности",
        options: ["поверхности", "территории", "площади", "пространства"]
    },
    {
        sentence: "Каждый день совершаются новые научные ___.",
        answer: "открытия",
        options: ["открытия", "изобретения", "обнаружения", "находки"]
    },
    {
        sentence: "Математика развивает ___ мышление и помогает решать сложные задачи.",
        answer: "логическое",
        options: ["логическое", "творческое", "аналитическое", "критическое"]
    },
    {
        sentence: "Семья — это ___ общества, где формируются первые ценности человека.",
        answer: "основа",
        options: ["основа", "часть", "ячейка", "единица"]
    },
    {
        sentence: "Природа нуждается в нашей ___ и защите.",
        answer: "заботе",
        options: ["заботе", "помощи", "поддержке", "охране"]
    },
    {
        sentence: "История учит нас не повторять ___ прошлого.",
        answer: "ошибок",
        options: ["ошибок", "проблем", "неудач", "провалов"]
    },
    {
        sentence: "Дружба строится на взаимном ___ и понимании.",
        answer: "уважении",
        options: ["уважении", "доверии", "интересе", "внимании"]
    }
];

// 9. Тексты для скорости чтения (50 текстов)
const speedReadingTexts = [
    "История Казахстана богата событиями и героями. От древних кочевников до современного государства, казахский народ сохранил свою уникальную культуру и традиции. Великий Шёлковый путь проходил через территорию Казахстана, способствуя развитию торговли и культурному обмену.",
    "Научные открытия меняют наш мир. Каждый день исследователи в разных странах работают над решением глобальных проблем: от изменения климата до борьбы с болезнями. Образование и наука являются ключом к прогрессу человечества.",
    "Литература открывает нам новые миры. Читая книги, мы можем путешествовать во времени и пространстве, знакомиться с разными культурами и понимать чувства других людей. Хорошая книга может изменить взгляд на жизнь.",
    "Технологии стремительно развиваются. За последние 20 лет компьютеры и интернет изменили способы общения, обучения и работы. Цифровые технологии продолжают трансформировать все сферы нашей жизни.",
    "Экология стала важнейшей темой современности. Загрязнение окружающей среды, изменение климата и исчезновение видов требуют срочных действий. Каждый человек может внести свой вклад в сохранение природы.",
    "Искусство отражает душу народа и эпохи. Через картины, музыку и литературу мы можем понять мысли и чувства людей, живших в разные времена. Искусство объединяет поколения и культуры.",
    "Спорт укрепляет не только тело, но и дух. Регулярные физические упражнения улучшают здоровье, развивают дисциплину и учат достигать целей. Спорт объединяет людей по всему миру.",
    "Музыка обладает удивительной силой воздействия на человека. Она может поднимать настроение, успокаивать, вдохновлять и даже лечить. Музыкальный вкус формируется под влиянием культуры и воспитания.",
    "Путешествия расширяют кругозор. Посещая новые места, мы знакомимся с разными культурами, традициями и образом жизни. Путешествия делают нас более терпимыми и понимающими.",
    "Образование — это инвестиция в будущее. Хорошее образование открывает возможности для профессионального роста и личностного развития. Образованный человек может лучше адаптироваться к изменениям в мире."
];

// ===== СИСТЕМА УПРАВЛЕНИЯ =====
function initStats() {
    try {
        const savedStats = loadCurrentUserStats();
        if (savedStats) {
            gameStats = savedStats;
        }
    } catch (e) {
        console.error('Ошибка загрузки статистики:', e);
        resetStats();
    }
    updateStatsDisplay();
}

function saveStats() {
    try {
        saveCurrentUserStats(gameStats);
    } catch (e) {
        console.error('Ошибка сохранения статистики:', e);
    }
}

function resetStats() {
    if (confirm("Вы уверены, что хотите сбросить всю статистику? Все ваши достижения будут потеряны.")) {
        gameStats = {
            points: 0,
            gamesPlayed: 0,
            readingSpeed: 0,
            typingSpeed: 0,
            maxAccuracy: 0,
            maxWPM: 0,
            maxReadingSpeed: 0,
            gameProgress: {},
            achievements: [],
            modeProgress: {}
        };
        saveStats();
        updateStatsDisplay();
        alert("Статистика сброшена! Теперь новый ученик может начать с чистого листа.");
    }
}

function updateStatsDisplay() {
    const totalPoints = document.getElementById('totalPoints');
    const gamesPlayed = document.getElementById('gamesPlayed');
    const readingSpeed = document.getElementById('readingSpeed');
    const typingSpeed = document.getElementById('typingSpeed');
    const currentUsername = document.getElementById('current-username');
    
    if (totalPoints) totalPoints.textContent = gameStats.points;
    if (gamesPlayed) gamesPlayed.textContent = gameStats.gamesPlayed;
    if (readingSpeed) readingSpeed.textContent = gameStats.readingSpeed;
    if (typingSpeed) typingSpeed.textContent = gameStats.typingSpeed;
    if (currentUsername && currentUser) {
        currentUsername.textContent = currentUser;
    }
}

function showStatsModal() {
    const modal = document.getElementById('statsModal');
    const statsDetails = document.getElementById('statsDetails');
    
    let html = `
        <h3>Статистика пользователя: ${currentUser || 'Гость'}</h3>
        <h4>Прогресс по режимам:</h4>
        <div class="progress-bars">`;
    
    // Прогресс по каждому режиму
    const modeNames = {
        1: "Линейное чтение",
        2: "Цифровое чтение",
        3: "Клавиатурный тренажёр",
        4: "Исторические тексты",
        5: "Научный текст",
        6: "Поэзия",
        7: "Иностранный язык",
        8: "Текст с пропусками",
        9: "Тест скорости чтения"
    };
    
    for (let i = 1; i <= 9; i++) {
        const progress = gameStats.modeProgress[i] || 0;
        const played = gameStats.gameProgress[i] ? gameStats.gameProgress[i].played : false;
        
        html += `
            <div class="progress-label">
                <span>${modeNames[i]}</span>
                <span>${progress}%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: ${progress}%"></div>
            </div>`;
    }
    
    html += `
        </div>
        
        <h4>Рекорды:</h4>
        <ul>
            <li>Максимальная скорость печати: <span id="maxWPM">${gameStats.maxWPM}</span> слов/мин</li>
            <li>Максимальная скорость чтения: <span id="maxReadingSpeed">${gameStats.maxReadingSpeed}</span> слов/мин</li>
            <li>Лучшая точность печати: <span id="maxAccuracy">${gameStats.maxAccuracy}%</span></li>
            <li>Всего баллов: <span id="totalPointsModal">${gameStats.points}</span></li>
        </ul>
        
        <h4>Достижения:</h4>
        <div style="max-height: 200px; overflow-y: auto; padding: 10px; background: #f5f5f5; border-radius: 10px;">
            ${gameStats.achievements.length > 0 ? 
                `<ul>${gameStats.achievements.map((ach, idx) => `<li>${idx + 1}. ${ach}</li>`).slice(0, 10).join('')}</ul>` : 
                '<p>Пока нет достижений. Пройдите режимы, чтобы получить их!</p>'}
            ${gameStats.achievements.length > 10 ? `<p>...и ещё ${gameStats.achievements.length - 10} достижений</p>` : ''}
        </div>
    `;
    
    statsDetails.innerHTML = html;
    modal.classList.add('active');
}

function hideStatsModal() {
    document.getElementById('statsModal').classList.remove('active');
}

function updateModeProgress(mode, percentage) {
    if (!gameStats.modeProgress[mode] || gameStats.modeProgress[mode] < percentage) {
        gameStats.modeProgress[mode] = percentage;
        saveStats();
    }
}

// ===== УПРАВЛЕНИЕ ИГРАМИ =====
function startGame(gameNumber) {
    currentGame = gameNumber;
    
    // Скрыть все секции
    const sections = document.querySelectorAll('.game-section');
    sections.forEach(section => {
        section.classList.remove('active');
    });
    
    // Показать выбранную секцию
    const targetSection = document.getElementById(`game-${gameNumber}`);
    if (targetSection) {
        targetSection.classList.add('active');
    }
    
    // Инициализация конкретного режима
    switch(gameNumber) {
        case 1:
            loadRandomStory();
            break;
        case 2:
            showRandomOceanFact();
            break;
        case 3:
            initTypingGame();
            break;
        case 4:
            loadHistoricalFacts();
            break;
        case 5:
            loadScientificArticle();
            break;
        case 6:
            loadPoem();
            break;
        case 7:
            loadEnglishSentence();
            break;
        case 8:
            loadGapSentence();
            break;
        case 9:
            initSpeedReading();
            break;
    }
    
    // Обновить статистику
    if (!gameStats.gameProgress[gameNumber]) {
        gameStats.gameProgress[gameNumber] = { played: false, score: 0 };
        gameStats.gamesPlayed++;
        saveStats();
        updateStatsDisplay();
    }
}

function backToMenu() {
    currentGame = 0;
    document.querySelectorAll('.game-section').forEach(section => {
        section.classList.remove('active');
    });
    const mainMenu = document.getElementById('main-menu');
    if (mainMenu) {
        mainMenu.classList.add('active');
    }
    saveStats();
}

// ===== РЕЖИМ 1: ЦВЕТЫ НА КРЫШЕ =====
let usedStoryIndexes = [];

function loadRandomStory() {
    const storyContent = document.getElementById('storyContent1');
    const questionsContainer = document.getElementById('questions1');
    
    if (!storyContent || !questionsContainer) return;
    
    // Если все тексты использованы, сбрасываем список
    if (usedStoryIndexes.length >= storyTexts.length) {
        usedStoryIndexes = [];
    }
    
    // Выбираем случайный текст, который ещё не использовался
    let randomIndex;
    do {
        randomIndex = Math.floor(Math.random() * storyTexts.length);
    } while (usedStoryIndexes.includes(randomIndex));
    
    usedStoryIndexes.push(randomIndex);
    const story = storyTexts[randomIndex];
    
    // Отображаем текст
    storyContent.innerHTML = `
        <h3>${story.title}</h3>
        <p class="${getHighlightClass(story.highlight)}">${story.content}</p>
        <div style="margin-top: 20px; font-size: 0.9rem; color: #666;">
            <i class="fas fa-info-circle"></i> Текст ${randomIndex + 1} из ${storyTexts.length}
        </div>
    `;
    
    // Создаём вопросы на основе текста
    questionsContainer.innerHTML = generateQuestionsForStory(story);
    
    // Обновляем статистику
    gameStats.points += 2;
    updateModeProgress(1, Math.floor((usedStoryIndexes.length / storyTexts.length) * 100));
    updateStatsDisplay();
}

function getHighlightClass(highlight) {
    switch(highlight) {
        case 'problem': return 'highlight-problem';
        case 'feeling': return 'highlight-feeling';
        case 'solution': return 'highlight-solution';
        default: return '';
    }
}

function generateQuestionsForStory(story) {
    const questions = [
        "Какая основная идея этого отрывка?",
        "Какие чувства или проблемы описываются?",
        "Как этот отрывок связан с основной темой рассказа?",
        "Что вы думаете о ситуации, описанной в тексте?",
        "Как бы вы поступили на месте героя?"
    ];
    
    let html = '';
    questions.forEach((question, index) => {
        html += `
            <div class="question">
                <p>${index + 1}. ${question}</p>
                <textarea class="answer-input" rows="2" placeholder="Ваш ответ..."></textarea>
            </div>
        `;
    });
    
    return html;
}

function checkAnswers(gameNum) {
    const gameSection = document.getElementById(`game-${gameNum}`);
    if (!gameSection) return;
    
    const answers = gameSection.querySelectorAll('.answer-input');
    let total = answers.length;
    let answered = 0;
    
    answers.forEach((answer) => {
        if (answer.value.trim().length > 10) {
            answer.style.border = '2px solid #4CAF50';
            answered++;
        } else {
            answer.style.border = '2px solid #F44336';
        }
    });
    
    if (answered === total) {
        gameStats.points += 10;
        gameStats.gameProgress[gameNum] = { played: true, score: 10 };
        updateModeProgress(gameNum, 100);
        alert(`🎉 Отлично! Все ответы подробные! +10 баллов`);
    } else {
        alert(`Заполнено ${answered} из ${total} ответов. Постарайтесь дать более развёрнутые ответы!`);
    }
    
    saveStats();
    updateStatsDisplay();
}

// ===== РЕЖИМ 2: ОКЕАНЫ =====
let usedOceanFactIndexes = [];
let currentOceanPage = 'intro';

function showRandomOceanFact() {
    const content = document.getElementById('oceanContent');
    if (!content) return;
    
    currentOceanPage = 'intro';
    
    // Если все факты использованы, сбрасываем список
    if (usedOceanFactIndexes.length >= oceanFacts.length) {
        usedOceanFactIndexes = [];
    }
    
    // Выбираем случайный факт, который ещё не использовался
    let randomIndex;
    do {
        randomIndex = Math.floor(Math.random() * oceanFacts.length);
    } while (usedOceanFactIndexes.includes(randomIndex));
    
    usedOceanFactIndexes.push(randomIndex);
    const fact = oceanFacts[randomIndex];
    currentOceanPage = fact.category;
    
    showOceanPageForCurrentFact(fact.category, fact, randomIndex);
    
    // Обновляем статистику
    gameStats.points += 2;
    updateModeProgress(2, Math.floor((usedOceanFactIndexes.length / oceanFacts.length) * 100));
    updateStatsDisplay();
}

function showOceanPageForCurrentFact(page, fact, index) {
    const content = document.getElementById('oceanContent');
    if (!content) return;
    
    const pages = {
        intro: {
            title: "Введение в исследование океанов",
            content: `<p>Океаны - жизненно важная система нашей планеты. Они регулируют климат, производят кислород и являются домом для миллионов видов живых организмов.</p>
                     <p>Исследование океанов помогает нам понять процессы, влияющие на всю планету, и разработать стратегии их защиты.</p>`
        },
        problem: {
            title: "Проблема загрязнения океанов",
            content: `<p>Пластик стал серьёзной угрозой для морских экосистем. Ежегодно в океан попадает огромное количество пластиковых отходов, которые наносят вред животным и растениям.</p>
                     <p>Морские животные часто принимают пластик за пищу, что приводит к их гибели и нарушению пищевых цепей.</p>`
        },
        research: {
            title: "Методы исследования океанов",
            content: `<p>Учёные используют различные методы для изучения океана: спутниковые наблюдения, подводные роботы, глубоководные аппараты и современные лабораторные анализы.</p>
                     <p>Современные технологии позволяют изучать даже самые глубокие и труднодоступные части океана.</p>`
        },
        sources: {
            title: "Оценка источников информации",
            content: `<p>Важно отличать научные статьи от популярных публикаций. Научные источники проходят рецензирование и содержат проверенные данные, основанные на исследованиях.</p>
                     <p>Проверяйте авторитетность источников, авторов и организаций перед использованием информации в своих исследованиях.</p>`
        },
        conclusion: {
            title: "Выводы и решения",
            content: `<p>Необходимы срочные меры по сокращению пластиковых отходов: переработка, использование альтернативных материалов, очистка океанов и изменение потребительских привычек.</p>
                     <p>Каждый человек может внести свой вклад, сократив использование одноразового пластика и участвуя в экологических инициативах.</p>`
        }
    };
    
    const pageData = pages[page] || pages.intro;
    
    content.innerHTML = `
        <h2>${pageData.title}</h2>
        ${pageData.content}
        
        <div class="fact-box">
            <h4><i class="fas fa-lightbulb"></i> Факт №${index + 1} из ${oceanFacts.length}:</h4>
            <p>${fact.fact}</p>
            <button class="action-btn secondary collect-fact-btn">
                <i class="fas fa-save"></i> Сохранить факт
            </button>
        </div>
        
        <div style="margin-top: 30px;">
            <h4>Вопросы для размышления:</h4>
            <ol>
                <li>Как этот факт связан с проблемой загрязнения океанов?</li>
                <li>Какие решения можно предложить на основе этой информации?</li>
                <li>Как вы можете применить эти знания в повседневной жизни?</li>
            </ol>
            <textarea style="width: 100%; height: 150px; padding: 15px; border-radius: 10px; border: 2px solid #ddd; margin-top: 15px;" 
                      placeholder="Запишите свои мысли и идеи..."></textarea>
        </div>
    `;
    
    // Добавляем обработчик для кнопки сохранения факта
    const saveBtn = content.querySelector('.collect-fact-btn');
    if (saveBtn) {
        saveBtn.addEventListener('click', function() {
            collectFact(2, fact.fact);
        });
    }
}

function collectFact(gameNum, factText) {
    if (!factText) return;
    
    if (!gameStats.achievements.includes(factText)) {
        gameStats.achievements.push(factText);
        gameStats.points += 5;
        alert(`✅ Факт сохранён! +5 баллов\nТеперь у вас ${gameStats.achievements.length} сохранённых фактов.`);
        saveStats();
        updateStatsDisplay();
    } else {
        alert('Этот факт уже сохранён в вашей коллекции!');
    }
}

// ===== РЕЖИМ 3: КЛАВИАТУРНЫЙ ТРЕНАЖЁР =====
let typingGame = {
    currentText: '',
    currentIndex: 0,
    correctChars: 0,
    totalChars: 0,
    startTime: 0,
    timer: null,
    isRunning: false,
    errors: 0
};

function initTypingGame() {
    const typingText = document.getElementById('typingText');
    const typingInput = document.getElementById('typingInput');
    
    // Выбираем случайный текст
    const randomIndex = Math.floor(Math.random() * typingTexts.length);
    typingGame.currentText = typingTexts[randomIndex];
    typingGame.currentIndex = 0;
    typingGame.correctChars = 0;
    typingGame.totalChars = typingGame.currentText.length;
    typingGame.errors = 0;
    
    // Отображаем текст
    let displayText = '';
    for (let i = 0; i < typingGame.currentText.length; i++) {
        if (i === typingGame.currentIndex) {
            displayText += `<span class="current-char">${typingGame.currentText[i]}</span>`;
        } else if (i < typingGame.currentIndex) {
            displayText += `<span class="correct-char">${typingGame.currentText[i]}</span>`;
        } else {
            displayText += typingGame.currentText[i];
        }
    }
    
    typingText.innerHTML = displayText;
    typingInput.value = '';
    typingInput.disabled = false;
    typingInput.focus();
    
    // Создаём клавиатуру
    createKeyboard();
    
    // Сбрасываем таймер
    clearInterval(typingGame.timer);
    typingGame.isRunning = false;
    document.getElementById('timeLeft').textContent = '60';
    document.getElementById('wpm').textContent = '0';
    document.getElementById('accuracy').textContent = '100%';
    document.getElementById('charsTyped').textContent = '0';
    
    // Обновляем прогресс
    updateModeProgress(3, Math.floor((Math.random() * 50) + 50));
}

function createKeyboard() {
    const keyboard = document.getElementById('keyboard');
    if (!keyboard) return;
    
    const keys = [
        'й', 'ц', 'у', 'к', 'е', 'н', 'г', 'ш', 'щ', 'з', 'х',
        'ф', 'ы', 'в', 'а', 'п', 'р', 'о', 'л', 'д', 'ж', 'э',
        'я', 'ч', 'с', 'м', 'и', 'т', 'ь', 'б', 'ю'
    ];
    
    let html = '';
    keys.forEach((key, index) => {
        html += `<div class="key" data-key="${key}">${key}</div>`;
        if ((index + 1) % 10 === 0) {
            html += '<div style="grid-column: span 2;"></div>';
        }
    });
    
    keyboard.innerHTML = html;
}

function startTypingTest() {
    if (typingGame.isRunning) return;
    
    typingGame.startTime = Date.now();
    typingGame.isRunning = true;
    typingGame.timer = setInterval(updateTypingTimer, 1000);
    
    const typingInput = document.getElementById('typingInput');
    typingInput.disabled = false;
    typingInput.focus();
    
    // Обработчик ввода
    typingInput.addEventListener('input', handleTypingInput);
    typingInput.addEventListener('keydown', handleTypingKeyDown);
}

function updateTypingTimer() {
    const timeLeft = document.getElementById('timeLeft');
    let seconds = parseInt(timeLeft.textContent);
    
    if (seconds <= 0) {
        finishTypingTest();
        return;
    }
    
    seconds--;
    timeLeft.textContent = seconds;
    
    // Обновляем WPM
    const elapsedTime = (60 - seconds) / 60;
    if (elapsedTime > 0) {
        const wpm = Math.floor((typingGame.correctChars / 5) / elapsedTime);
        document.getElementById('wpm').textContent = wpm;
        
        if (wpm > gameStats.maxWPM) {
            gameStats.maxWPM = wpm;
            gameStats.typingSpeed = wpm;
        }
    }
    
    // Обновляем точность
    const accuracy = typingGame.totalChars > 0 ? 
        Math.floor(((typingGame.correctChars - typingGame.errors) / typingGame.totalChars) * 100) : 100;
    document.getElementById('accuracy').textContent = Math.max(accuracy, 0) + '%';
    
    if (accuracy > gameStats.maxAccuracy) {
        gameStats.maxAccuracy = accuracy;
    }
    
    document.getElementById('charsTyped').textContent = typingGame.correctChars;
}

function handleTypingInput(e) {
    const input = e.target.value;
    const lastChar = input[input.length - 1];
    const expectedChar = typingGame.currentText[typingGame.currentIndex];
    
    if (lastChar === expectedChar) {
        typingGame.correctChars++;
        typingGame.currentIndex++;
        
        // Проверяем, закончился ли текст
        if (typingGame.currentIndex >= typingGame.currentText.length) {
            finishTypingTest();
            return;
        }
    } else {
        typingGame.errors++;
    }
    
    // Обновляем отображение
    const typingText = document.getElementById('typingText');
    let displayText = '';
    for (let i = 0; i < typingGame.currentText.length; i++) {
        if (i === typingGame.currentIndex) {
            displayText += `<span class="current-char">${typingGame.currentText[i]}</span>`;
        } else if (i < typingGame.currentIndex) {
            displayText += `<span class="correct-char">${typingGame.currentText[i]}</span>`;
        } else {
            displayText += typingGame.currentText[i];
        }
    }
    
    typingText.innerHTML = displayText;
    
    // Обновляем статистику
    updateTypingStats();
}

function handleTypingKeyDown(e) {
    // Подсвечиваем клавишу на виртуальной клавиатуре
    const key = e.key.toLowerCase();
    const keyElement = document.querySelector(`.key[data-key="${key}"]`);
    if (keyElement) {
        keyElement.classList.add('active');
        setTimeout(() => keyElement.classList.remove('active'), 200);
    }
}

function updateTypingStats() {
    const elapsedTime = (Date.now() - typingGame.startTime) / 60000;
    const wpm = Math.floor((typingGame.correctChars / 5) / elapsedTime) || 0;
    const accuracy = typingGame.totalChars > 0 ? 
        Math.floor(((typingGame.correctChars - typingGame.errors) / typingGame.totalChars) * 100) : 100;
    
    document.getElementById('wpm').textContent = wpm;
    document.getElementById('accuracy').textContent = Math.max(accuracy, 0) + '%';
    document.getElementById('charsTyped').textContent = typingGame.correctChars;
}

function finishTypingTest() {
    clearInterval(typingGame.timer);
    typingGame.isRunning = false;
    
    const typingInput = document.getElementById('typingInput');
    typingInput.disabled = true;
    
    // Рассчитываем итоговую статистику
    const wpm = parseInt(document.getElementById('wpm').textContent) || 0;
    const accuracy = parseInt(document.getElementById('accuracy').textContent) || 0;
    
    // Начисляем баллы
    const points = Math.floor(wpm * 0.1 + accuracy * 0.5);
    gameStats.points += points;
    
    // Обновляем рекорды
    if (wpm > gameStats.maxWPM) {
        gameStats.maxWPM = wpm;
        gameStats.typingSpeed = wpm;
    }
    if (accuracy > gameStats.maxAccuracy) {
        gameStats.maxAccuracy = accuracy;
    }
    
    alert(`🎉 Тест завершён!\nСкорость: ${wpm} слов/мин\nТочность: ${accuracy}%\nНачислено баллов: ${points}`);
    
    saveStats();
    updateStatsDisplay();
    updateModeProgress(3, 100);
}

function resetTypingTest() {
    clearInterval(typingGame.timer);
    typingGame.isRunning = false;
    initTypingGame();
}

// ===== РЕЖИМ 4: ИСТОРИЧЕСКИЕ ТЕКСТЫ =====
let usedHistoryIndexes = [];

function loadHistoricalFacts() {
    const container = document.getElementById('historicalFacts');
    if (!container) return;
    
    // Если все факты использованы, сбрасываем список
    if (usedHistoryIndexes.length >= historicalFacts.length) {
        usedHistoryIndexes = [];
    }
    
    // Выбираем 3 случайных факта, которые ещё не использовались
    const factsToShow = [];
    for (let i = 0; i < 3; i++) {
        let randomIndex;
        do {
            randomIndex = Math.floor(Math.random() * historicalFacts.length);
        } while (usedHistoryIndexes.includes(randomIndex) || factsToShow.some(f => f.index === randomIndex));
        
        usedHistoryIndexes.push(randomIndex);
        factsToShow.push({
            index: randomIndex,
            fact: historicalFacts[randomIndex]
        });
    }
    
    let html = '<h2 style="margin-bottom: 30px; color: #9C27B0;">Исторические факты о Казахстане</h2>';
    
    factsToShow.forEach((item, idx) => {
        html += `
            <div class="fact-item">
                <h4>Факт ${item.index + 1} из ${historicalFacts.length}</h4>
                <p><strong>Период:</strong> ${item.fact.year}</p>
                <p>${item.fact.fact}</p>
                <div style="margin-top: 15px;">
                    <h5>Вопросы для анализа:</h5>
                    <ol>
                        <li>Какое значение имеет этот факт для истории Казахстана?</li>
                        <li>Как этот период повлиял на современность?</li>
                        <li>Что нового вы узнали из этого факта?</li>
                    </ol>
                    <textarea style="width: 100%; height: 80px; padding: 10px; border-radius: 8px; border: 2px solid #ddd; margin-top: 10px;" 
                              placeholder="Ваши мысли..."></textarea>
                </div>
            </div>
        `;
    });
    
    container.innerHTML = html;
    
    // Обновляем статистику
    gameStats.points += 5;
    updateModeProgress(4, Math.floor((usedHistoryIndexes.length / historicalFacts.length) * 100));
    updateStatsDisplay();
}

// ===== РЕЖИМ 5: НАУЧНЫЙ ТЕКСТ =====
let usedArticleIndexes = [];

function loadScientificArticle() {
    const container = document.getElementById('scientificArticles');
    if (!container) return;
    
    // Если все статьи использованы, сбрасываем список
    if (usedArticleIndexes.length >= scientificArticles.length) {
        usedArticleIndexes = [];
    }
    
    // Выбираем случайную статью, которая ещё не использовалась
    let randomIndex;
    do {
        randomIndex = Math.floor(Math.random() * scientificArticles.length);
    } while (usedArticleIndexes.includes(randomIndex));
    
    usedArticleIndexes.push(randomIndex);
    const article = scientificArticles[randomIndex];
    
    let html = `
        <h2 style="margin-bottom: 20px; color: #2196F3;">${article.title}</h2>
        <div class="article-item">
            <p>${article.content}</p>
        </div>
        
        <div style="margin-top: 30px;">
            <h4>Термины для изучения:</h4>
            <ul>
                ${article.terms.map(term => `<li><strong>${term}</strong> - определение при наведении курсора</li>`).join('')}
            </ul>
            
            <h4 style="margin-top: 20px;">Вопросы для проверки понимания:</h4>
            <ol>
                <li>Какая основная идея этой научной статьи?</li>
                <li>Как работают описанные в статье процессы или явления?</li>
                <li>Какое практическое значение имеет эта информация?</li>
            </ol>
            
            <textarea style="width: 100%; height: 150px; padding: 15px; border-radius: 10px; border: 2px solid #2196F3; margin-top: 15px;" 
                      placeholder="Запишите свои ответы на вопросы..."></textarea>
        </div>
        
        <div style="margin-top: 20px; font-size: 0.9rem; color: #666;">
            <i class="fas fa-info-circle"></i> Статья ${randomIndex + 1} из ${scientificArticles.length}
        </div>
    `;
    
    container.innerHTML = html;
    
    // Обновляем статистику
    gameStats.points += 3;
    updateModeProgress(5, Math.floor((usedArticleIndexes.length / scientificArticles.length) * 100));
    updateStatsDisplay();
}

// ===== РЕЖИМ 6: ПОЭЗИЯ =====
let usedPoemIndexes = [];

function loadPoem() {
    const container = document.getElementById('poetryContainer');
    if (!container) return;
    
    // Если все стихи использованы, сбрасываем список
    if (usedPoemIndexes.length >= poems.length) {
        usedPoemIndexes = [];
    }
    
    // Выбираем случайное стихотворение, которое ещё не использовалось
    let randomIndex;
    do {
        randomIndex = Math.floor(Math.random() * poems.length);
    } while (usedPoemIndexes.includes(randomIndex));
    
    usedPoemIndexes.push(randomIndex);
    const poem = poems[randomIndex];
    
    let html = `
        <div class="poem-title">${poem.title}</div>
        <div style="font-style: italic; margin-bottom: 30px; color: #795548;">${poem.author}</div>
    `;
    
    // Добавляем строки с задержкой для анимации
    poem.lines.forEach((line, index) => {
        html += `<div class="poem-line" style="animation-delay: ${index * 0.3}s;">${line}</div>`;
    });
    
    html += `
        <div style="margin-top: 40px;">
            <h4>Вопросы для анализа:</h4>
            <ol>
                <li>Какое настроение создаёт это стихотворение?</li>
                <li>Какие образы и метафоры используются в тексте?</li>
                <li>Что хотел передать автор через это произведение?</li>
            </ol>
            
            <textarea style="width: 100%; height: 120px; padding: 15px; border-radius: 10px; border: 2px solid #795548; margin-top: 15px; font-family: 'Georgia', serif;" 
                      placeholder="Ваши мысли о стихотворении..."></textarea>
        </div>
        
        <div style="margin-top: 20px; font-size: 0.9rem; color: #666;">
            <i class="fas fa-info-circle"></i> Стихотворение ${randomIndex + 1} из ${poems.length}
        </div>
    `;
    
    container.innerHTML = html;
    
    // Обновляем статистику
    gameStats.points += 2;
    updateModeProgress(6, Math.floor((usedPoemIndexes.length / poems.length) * 100));
    updateStatsDisplay();
}

// ===== РЕЖИМ 7: ИНОСТРАННЫЙ ЯЗЫК =====
let usedSentenceIndexes = [];

function loadEnglishSentence() {
    const container = document.getElementById('languageExercise');
    if (!container) return;
    
    // Если все предложения использованы, сбрасываем список
    if (usedSentenceIndexes.length >= englishSentences.length) {
        usedSentenceIndexes = [];
    }
    
    // Выбираем случайное предложение, которое ещё не использовалось
    let randomIndex;
    do {
        randomIndex = Math.floor(Math.random() * englishSentences.length);
    } while (usedSentenceIndexes.includes(randomIndex));
    
    usedSentenceIndexes.push(randomIndex);
    const sentence = englishSentences[randomIndex];
    
    let html = `
        <div class="translation-box">
            <div class="english-text">
                <i class="fas fa-language"></i> ${sentence.english}
            </div>
            <div style="margin-bottom: 20px; color: #666;">
                <i class="fas fa-tag"></i> Сложность: 
                <span style="padding: 3px 10px; border-radius: 12px; font-size: 0.8rem; background: ${getDifficultyColor(sentence.difficulty)}">
                    ${getDifficultyText(sentence.difficulty)}
                </span>
            </div>
            
            <h4>Переведите на русский язык:</h4>
            <textarea class="translation-input" id="translationInput" placeholder="Введите ваш перевод здесь..."></textarea>
            
            <div style="margin-top: 30px; display: none;" id="correctTranslation">
                <h4><i class="fas fa-check-circle" style="color: #4CAF50;"></i> Правильный перевод:</h4>
                <div style="padding: 15px; background: #E8F5E9; border-radius: 10px; border-left: 4px solid #4CAF50;">
                    ${sentence.russian}
                </div>
            </div>
        </div>
        
        <div style="margin-top: 20px; font-size: 0.9rem; color: #666;">
            <i class="fas fa-info-circle"></i> Предложение ${randomIndex + 1} из ${englishSentences.length}
        </div>
    `;
    
    container.innerHTML = html;
    
    // Обновляем статистику
    gameStats.points += 1;
    updateModeProgress(7, Math.floor((usedSentenceIndexes.length / englishSentences.length) * 100));
    updateStatsDisplay();
}

function getDifficultyColor(difficulty) {
    switch(difficulty) {
        case 'easy': return '#C8E6C9';
        case 'medium': return '#FFF9C4';
        case 'hard': return '#FFCDD2';
        default: return '#F5F5F5';
    }
}

function getDifficultyText(difficulty) {
    switch(difficulty) {
        case 'easy': return 'Легко';
        case 'medium': return 'Средне';
        case 'hard': return 'Сложно';
        default: return 'Неизвестно';
    }
}

function checkTranslation() {
    const container = document.getElementById('languageExercise');
    if (!container) return;
    
    const translationInput = container.querySelector('#translationInput');
    const correctTranslationDiv = container.querySelector('#correctTranslation');
    
    if (!translationInput || !correctTranslationDiv) return;
    
    correctTranslationDiv.style.display = 'block';
    
    // Простая проверка
    const userTranslation = translationInput.value.trim().toLowerCase();
    const currentIndex = usedSentenceIndexes[usedSentenceIndexes.length - 1];
    const correctTranslation = englishSentences[currentIndex].russian.toLowerCase();
    
    // Более гибкая проверка
    const similarity = calculateSimilarity(userTranslation, correctTranslation);
    
    if (similarity > 0.7) {
        gameStats.points += 5;
        alert(`✅ Отличный перевод! Совпадение: ${Math.floor(similarity * 100)}% +5 баллов`);
    } else if (similarity > 0.4) {
        gameStats.points += 2;
        alert(`🤔 Неплохо, но можно лучше. Совпадение: ${Math.floor(similarity * 100)}% +2 балла`);
    } else {
        alert(`📝 Сравните ваш перевод с правильным вариантом. Попробуйте ещё раз!`);
    }
    
    saveStats();
    updateStatsDisplay();
}

function calculateSimilarity(str1, str2) {
    // Простая проверка схожести строк
    const words1 = str1.split(' ');
    const words2 = str2.split(' ');
    const commonWords = words1.filter(word => words2.includes(word));
    return commonWords.length / Math.max(words1.length, words2.length);
}

// ===== РЕЖИМ 8: ТЕКСТ С ПРОПУСКАМИ =====
let usedGapIndexes = [];

function loadGapSentence() {
    const container = document.getElementById('gapText');
    if (!container) return;
    
    // Если все предложения использованы, сбрасываем список
    if (usedGapIndexes.length >= gapSentences.length) {
        usedGapIndexes = [];
    }
    
    // Выбираем случайное предложение, которое ещё не использовалось
    let randomIndex;
    do {
        randomIndex = Math.floor(Math.random() * gapSentences.length);
    } while (usedGapIndexes.includes(randomIndex));
    
    usedGapIndexes.push(randomIndex);
    const gapSentence = gapSentences[randomIndex];
    
    // Заменяем пропуск на input
    const sentenceWithGap = gapSentence.sentence.replace('___', 
        `<span class="gap"><input type="text" class="gap-input" maxlength="20" placeholder="слово"></span>`);
    
    let html = `
        <div class="sentence-item">
            <h4>Заполните пропуск:</h4>
            <p style="font-size: 1.3rem; margin: 20px 0;">${sentenceWithGap}</p>
            
            <div style="margin-top: 20px;">
                <h5>Подсказки:</h5>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    ${gapSentence.options.map(option => 
                        `<span style="padding: 5px 10px; background: #E3F2FD; border-radius: 8px; cursor: help;" title="Возможный вариант">${option}</span>`
                    ).join('')}
                </div>
            </div>
            
            <div style="margin-top: 30px; display: none;" id="gapResult">
                <h4><i class="fas fa-check-circle" style="color: #4CAF50;"></i> Правильный ответ:</h4>
                <div style="padding: 15px; background: #E8F5E9; border-radius: 10px; border-left: 4px solid #4CAF50; font-size: 1.2rem;">
                    ${gapSentence.sentence.replace('___', `<strong>${gapSentence.answer}</strong>`)}
                </div>
            </div>
        </div>
        
        <div style="margin-top: 20px; font-size: 0.9rem; color: #666;">
            <i class="fas fa-info-circle"></i> Предложение ${randomIndex + 1} из ${gapSentences.length}
        </div>
    `;
    
    container.innerHTML = html;
    
    // Обновляем статистику
    gameStats.points += 1;
    updateModeProgress(8, Math.floor((usedGapIndexes.length / gapSentences.length) * 100));
    updateStatsDisplay();
}

function checkGaps() {
    const container = document.getElementById('gapText');
    if (!container) return;
    
    const gapInput = container.querySelector('.gap-input');
    const gapResult = container.querySelector('#gapResult');
    const currentIndex = usedGapIndexes[usedGapIndexes.length - 1];
    const correctAnswer = gapSentences[currentIndex].answer;
    
    if (!gapInput || !gapResult) return;
    
    const userAnswer = gapInput.value.trim().toLowerCase();
    gapResult.style.display = 'block';
    
    if (userAnswer === correctAnswer.toLowerCase()) {
        gapInput.style.borderBottom = '2px solid #4CAF50';
        gameStats.points += 3;
        alert(`✅ Правильно! +3 балла`);
    } else {
        gapInput.style.borderBottom = '2px solid #F44336';
        gameStats.points += 1;
        alert(`📝 Почти правильно! +1 балл за попытку`);
    }
    
    saveStats();
    updateStatsDisplay();
}

// ===== РЕЖИМ 9: ТЕСТ СКОРОСТИ ЧТЕНИЯ =====
let readingTest = {
    isRunning: false,
    startTime: 0,
    timer: null,
    wordsRead: 0,
    currentText: '',
    targetSpeed: 200
};

function initSpeedReading() {
    const speedText = document.getElementById('speedText');
    
    // Выбираем случайный текст
    const randomIndex = Math.floor(Math.random() * speedReadingTexts.length);
    readingTest.currentText = speedReadingTexts[randomIndex];
    readingTest.wordsRead = 0;
    readingTest.isRunning = false;
    
    // Отображаем текст
    speedText.innerHTML = `<p>${readingTest.currentText}</p>`;
    
    // Сбрасываем таймер
    clearInterval(readingTest.timer);
    document.getElementById('countdownTimer').textContent = '01:00';
    document.getElementById('readingSpeedValue').textContent = '0';
    document.getElementById('wordsRead').textContent = '0';
    document.getElementById('timeSpent').textContent = '0';
    document.getElementById('comprehensionScore').textContent = '0%';
    
    // Обновляем прогресс
    updateModeProgress(9, Math.floor((Math.random() * 40) + 60));
}

function startReadingTest() {
    if (readingTest.isRunning) return;
    
    readingTest.startTime = Date.now();
    readingTest.isRunning = true;
    
    let seconds = 60;
    const timerElement = document.getElementById('countdownTimer');
    
    readingTest.timer = setInterval(() => {
        seconds--;
        const minutes = Math.floor(seconds / 60);
        const secs = seconds % 60;
        timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        
        // Обновляем статистику в реальном времени
        if (seconds < 60) {
            const elapsedTime = (60 - seconds) / 60;
            const wordsPerMinute = Math.floor(readingTest.wordsRead / elapsedTime) || 0;
            document.getElementById('readingSpeedValue').textContent = wordsPerMinute;
            document.getElementById('wordsRead').textContent = readingTest.wordsRead;
            document.getElementById('timeSpent').textContent = 60 - seconds;
            
            // Обновляем рекорд
            if (wordsPerMinute > gameStats.maxReadingSpeed) {
                gameStats.maxReadingSpeed = wordsPerMinute;
                gameStats.readingSpeed = wordsPerMinute;
            }
        }
        
        if (seconds <= 0) {
            finishReadingTest();
        }
    }, 1000);
    
    // Включаем отслеживание прокрутки для подсчёта слов
    const speedText = document.getElementById('speedText');
    let lastScroll = 0;
    
    speedText.addEventListener('scroll', function() {
        const scrollPercent = (this.scrollTop + this.clientHeight) / this.scrollHeight;
        if (scrollPercent > lastScroll + 0.1) {
            readingTest.wordsRead += Math.floor(readingTest.currentText.split(' ').length * 0.1);
            lastScroll = scrollPercent;
        }
    });
}

function finishReadingTest() {
    clearInterval(readingTest.timer);
    readingTest.isRunning = false;
    
    const totalTime = 60;
    const wordsPerMinute = Math.floor(readingTest.wordsRead / (totalTime / 60));
    
    // Вопросы на понимание
    const questions = [
        "Какая основная тема текста?",
        "Какие факты или идеи были представлены?",
        "С какими выводами вы согласны?"
    ];
    
    let answers = '';
    questions.forEach((q, i) => {
        const answer = prompt(`${i + 1}. ${q}\n\nВведите ваш ответ:`) || 'Нет ответа';
        answers += answer + '\n\n';
    });
    
    // Оценка понимания (упрощённая)
    const comprehensionScore = Math.min(Math.floor(Math.random() * 30) + 70, 100);
    
    // Начисляем баллы
    const speedBonus = Math.floor(wordsPerMinute / 10);
    const comprehensionBonus = Math.floor(comprehensionScore / 10);
    const totalPoints = speedBonus + comprehensionBonus;
    
    gameStats.points += totalPoints;
    
    // Обновляем отображение
    document.getElementById('comprehensionScore').textContent = comprehensionScore + '%';
    
    alert(`📊 Результаты теста:\n\nСкорость чтения: ${wordsPerMinute} слов/мин\n\nОценка понимания: ${comprehensionScore}%\n\nБонус за скорость: +${speedBonus} баллов\n\nБонус за понимание: +${comprehensionBonus} баллов\n\nВсего начислено: +${totalPoints} баллов`);
    
    saveStats();
    updateStatsDisplay();
    updateModeProgress(9, 100);
}

// ===== ИНИЦИАЛИЗАЦИЯ И ОБРАБОТЧИКИ СОБЫТИЙ =====
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM загружен, инициализируем приложение...');
    
    // Загрузка пользователей и проверка авторизации
    loadUsers();
    
    if (checkAuth()) {
        // Пользователь авторизован, показываем главное меню
        initStats();
        showMainMenu();
    } else {
        // Пользователь не авторизован, показываем форму входа
        showAuthSection();
    }
    
    // Анимация карточек
    const cards = document.querySelectorAll('.mode-card');
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(30px)';
        
        setTimeout(() => {
            card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });
    
    // ===== ОБРАБОТЧИКИ СОБЫТИЙ ДЛЯ АВТОРИЗАЦИИ =====
    
    // Кнопка входа
    document.getElementById('login-btn')?.addEventListener('click', function() {
        const username = document.getElementById('login-username').value.trim();
        const password = document.getElementById('login-password').value;
        
        if (!username || !password) {
            alert('Заполните все поля!');
            return;
        }
        
        const result = loginUser(username, password);
        if (result.success) {
            initStats();
            showMainMenu();
            alert('Добро пожаловать, ' + username + '!');
        } else {
            alert('Ошибка: ' + result.message);
        }
    });
    
    // Кнопка регистрации
    document.getElementById('register-btn')?.addEventListener('click', function() {
        const username = document.getElementById('register-username').value.trim();
        const password = document.getElementById('register-password').value;
        const confirmPassword = document.getElementById('register-confirm').value;
        
        if (!username || !password || !confirmPassword) {
            alert('Заполните все поля!');
            return;
        }
        
        if (password !== confirmPassword) {
            alert('Пароли не совпадают!');
            return;
        }
        
        if (password.length < 4) {
            alert('Пароль должен содержать минимум 4 символа!');
            return;
        }
        
        const result = registerUser(username, password);
        if (result.success) {
            alert('Регистрация успешна! Теперь войдите в систему.');
            switchAuthForm('login');
            document.getElementById('login-username').value = username;
            document.getElementById('login-password').value = '';
            document.getElementById('login-username').focus();
        } else {
            alert('Ошибка: ' + result.message);
        }
    });
    
    // Переключение между формами входа и регистрации
    document.getElementById('switch-to-register')?.addEventListener('click', function() {
        switchAuthForm('register');
    });
    
    document.getElementById('switch-to-login')?.addEventListener('click', function() {
        switchAuthForm('login');
    });
    
    // Кнопка выхода
    document.getElementById('logout-btn')?.addEventListener('click', function() {
        logoutUser();
        showAuthSection();
        alert('Вы вышли из системы.');
    });
    
    // ===== ОБРАБОТЧИКИ СОБЫТИЙ ДЛЯ РЕЖИМОВ =====
    
    // 1. Карточки режимов
    document.querySelectorAll('.mode-card').forEach(card => {
        card.addEventListener('click', function() {
            const gameNumber = parseInt(this.dataset.game);
            console.log('Нажата карточка режима:', gameNumber);
            startGame(gameNumber);
        });
    });
    
    // 2. Кнопка "Назад"
    document.querySelectorAll('.back-btn').forEach(btn => {
        btn.addEventListener('click', backToMenu);
    });
    
    // 3. Кнопка статистики
    document.getElementById('showStatsBtn')?.addEventListener('click', showStatsModal);
    
    // 4. Кнопка сброса статистики
    document.getElementById('resetStatsBtn')?.addEventListener('click', resetStats);
    
    // 5. Кнопка закрытия модального окна
    document.getElementById('closeStatsModal')?.addEventListener('click', hideStatsModal);
    
    // 6. Клик по фону модального окна
    document.getElementById('statsModal')?.addEventListener('click', function(e) {
        if (e.target === this) hideStatsModal();
    });
    
    // 7. Кнопка проверки ответов в режиме 1
    document.querySelectorAll('.check-answers-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const gameNum = parseInt(this.dataset.game) || 1;
            checkAnswers(gameNum);
        });
    });
    
    // 8. Кнопка следующего текста в режиме 1
    document.getElementById('nextStoryBtn')?.addEventListener('click', loadRandomStory);
    
    // 9. Кнопка следующего факта в режиме 2
    document.getElementById('nextOceanFactBtn')?.addEventListener('click', showRandomOceanFact);
    
    // 10. Навигационные карточки в режиме 2
    document.querySelectorAll('.nav-card').forEach(card => {
        card.addEventListener('click', function() {
            const page = this.dataset.page;
            if (page && usedOceanFactIndexes.length > 0) {
                const currentFactIndex = usedOceanFactIndexes[usedOceanFactIndexes.length - 1];
                const currentFact = oceanFacts[currentFactIndex];
                showOceanPageForCurrentFact(page, currentFact, currentFactIndex);
            }
        });
    });
    
    // 11. Кнопки режима 3 (Клавиатурный тренажёр)
    document.querySelector('.start-typing-btn')?.addEventListener('click', startTypingTest);
    document.querySelector('.reset-typing-btn')?.addEventListener('click', resetTypingTest);
    
    // 12. Кнопка загрузки фактов в режиме 4
    document.getElementById('loadMoreFactsBtn')?.addEventListener('click', loadHistoricalFacts);
    
    // 13. Кнопка загрузки статьи в режиме 5
    document.getElementById('loadMoreArticlesBtn')?.addEventListener('click', loadScientificArticle);
    
    // 14. Кнопка загрузки стихотворения в режиме 6
    document.getElementById('loadNewPoemBtn')?.addEventListener('click', loadPoem);
    
    // 15. Кнопки режима 7 (Иностранный язык)
    document.getElementById('loadNewSentenceBtn')?.addEventListener('click', loadEnglishSentence);
    document.getElementById('checkTranslationBtn')?.addEventListener('click', checkTranslation);
    
    // 16. Кнопки режима 8 (Текст с пропусками)
    document.getElementById('loadNewGapSentenceBtn')?.addEventListener('click', loadGapSentence);
    document.getElementById('checkGapsBtn')?.addEventListener('click', checkGaps);
    
    // 17. Кнопки режима 9 (Тест скорости чтения)
    document.getElementById('startReadingBtn')?.addEventListener('click', startReadingTest);
    document.getElementById('finishReadingBtn')?.addEventListener('click', finishReadingTest);
    
    // 18. Кнопки выбора скорости в режиме 9
    document.querySelectorAll('.speed-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.speed-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            readingTest.targetSpeed = parseInt(this.dataset.speed);
        });
    });
    
    // Обработка нажатия ESC для закрытия модального окна
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            hideStatsModal();
        }
    });
    
    // Инициализация первого текста для каждого режима при загрузке
    setTimeout(() => {
        console.log('Инициализация данных...');
        loadRandomStory();
        showRandomOceanFact();
        initTypingGame();
        loadHistoricalFacts();
        loadScientificArticle();
        loadPoem();
        loadEnglishSentence();
        loadGapSentence();
        initSpeedReading();
    }, 100);
    
    console.log('Все обработчики событий установлены');
});

// Функции для управления отображением секций
function showAuthSection() {
    document.querySelectorAll('.game-section').forEach(section => {
        section.classList.remove('active');
    });
    document.getElementById('auth-section').classList.add('active');
}

function showMainMenu() {
    document.querySelectorAll('.game-section').forEach(section => {
        section.classList.remove('active');
    });
    document.getElementById('main-menu').classList.add('active');
    updateStatsDisplay();
}